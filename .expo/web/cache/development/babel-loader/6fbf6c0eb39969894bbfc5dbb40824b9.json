{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"firebaseConfig\", \"firebaseVersion\", \"appVerificationDisabledForTesting\", \"languageCode\", \"onVerify\", \"onLoad\", \"onError\", \"onFullChallenge\", \"invisible\", \"verify\"];\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport { DEFAULT_WEB_APP_OPTIONS } from 'expo-firebase-core';\nimport { CodedError } from 'expo-modules-core';\nimport * as React from 'react';\nimport { WebView } from \"./WebView\";\n\nfunction getWebviewSource(firebaseConfig, firebaseVersion) {\n  var appVerificationDisabledForTesting = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var languageCode = arguments.length > 3 ? arguments[3] : undefined;\n  var invisible = arguments.length > 4 ? arguments[4] : undefined;\n  firebaseVersion = firebaseVersion || '8.0.0';\n  return {\n    baseUrl: \"https://\" + firebaseConfig.authDomain,\n    html: \"\\n<!DOCTYPE html><html>\\n<head>\\n  <meta name=\\\"viewport\\\" content=\\\"width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no\\\">\\n  <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=edge,chrome=1\\\">\\n  <meta name=\\\"HandheldFriendly\\\" content=\\\"true\\\">\\n  <script src=\\\"https://www.gstatic.com/firebasejs/\" + firebaseVersion + \"/firebase-app.js\\\"></script>\\n  <script src=\\\"https://www.gstatic.com/firebasejs/\" + firebaseVersion + \"/firebase-auth.js\\\"></script>\\n  <script type=\\\"text/javascript\\\">firebase.initializeApp(\" + JSON.stringify(firebaseConfig) + \");</script>\\n  <style>\\n    html, body {\\n      height: 100%;\\n      \" + (invisible ? \"padding: 0; margin: 0;\" : \"\") + \"\\n    }\\n    #recaptcha-btn {\\n      width: 100%;\\n      height: 100%;\\n      padding: 0;\\n      margin: 0;\\n      border: 0;\\n      user-select: none;\\n      -webkit-user-select: none;\\n    }\\n  </style>\\n</head>\\n<body>\\n  \" + (invisible ? \"<button id=\\\"recaptcha-btn\\\" type=\\\"button\\\" onclick=\\\"onClickButton()\\\">Confirm reCAPTCHA</button>\" : \"<div id=\\\"recaptcha-cont\\\" class=\\\"g-recaptcha\\\"></div>\") + \"\\n  <script>\\n    var fullChallengeTimer;\\n    function onVerify(token) {\\n      if (fullChallengeTimer) {\\n        clearInterval(fullChallengeTimer);\\n        fullChallengeTimer = undefined;\\n      }\\n      window.ReactNativeWebView.postMessage(JSON.stringify({\\n        type: 'verify',\\n        token: token\\n      }));\\n    }\\n    function onLoad() {\\n      window.ReactNativeWebView.postMessage(JSON.stringify({\\n        type: 'load'\\n      }));\\n      firebase.auth().settings.appVerificationDisabledForTesting = \" + appVerificationDisabledForTesting + \";\\n      \" + (languageCode ? \"firebase.auth().languageCode = '\" + languageCode + \"';\" : '') + \"\\n      window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(\\\"\" + (invisible ? 'recaptcha-btn' : 'recaptcha-cont') + \"\\\", {\\n        size: \\\"\" + (invisible ? 'invisible' : 'normal') + \"\\\",\\n        callback: onVerify\\n      });\\n      window.recaptchaVerifier.render();\\n    }\\n    function onError() {\\n      window.ReactNativeWebView.postMessage(JSON.stringify({\\n        type: 'error'\\n      }));\\n    }\\n    function onClickButton() {\\n      if (!fullChallengeTimer) {\\n        fullChallengeTimer = setInterval(function() {\\n          var iframes = document.getElementsByTagName(\\\"iframe\\\");\\n          var isFullChallenge = false;\\n          for (i = 0; i < iframes.length; i++) {\\n            var parentWindow = iframes[i].parentNode ? iframes[i].parentNode.parentNode : undefined;\\n            var isHidden = parentWindow && parentWindow.style.opacity == 0;\\n            isFullChallenge = isFullChallenge || (\\n              !isHidden && \\n              ((iframes[i].title === 'recaptcha challenge') ||\\n               (iframes[i].src.indexOf('google.com/recaptcha/api2/bframe') >= 0)));\\n          }\\n          if (isFullChallenge) {\\n            clearInterval(fullChallengeTimer);\\n            fullChallengeTimer = undefined;\\n            window.ReactNativeWebView.postMessage(JSON.stringify({\\n              type: 'fullChallenge'\\n            }));  \\n          }\\n        }, 100);\\n      }\\n    }\\n    window.addEventListener('message', function(event) {\\n      if (event.data.verify) {\\n        document.getElementById('recaptcha-btn').click();\\n      }\\n    });\\n  </script>\\n  <script src=\\\"https://www.google.com/recaptcha/api.js?onload=onLoad&render=explicit&hl=\" + (languageCode != null ? languageCode : '') + \"\\\" onerror=\\\"onError()\\\"></script>\\n</body></html>\"\n  };\n}\n\nfunction validateFirebaseConfig(firebaseConfig) {\n  if (!firebaseConfig) {\n    throw new CodedError('ERR_FIREBASE_RECAPTCHA_CONFIG', \"Missing firebase web configuration. Please set the \\\"expo.web.config.firebase\\\" field in \\\"app.json\\\" or use the \\\"firebaseConfig\\\" prop.\");\n  }\n\n  var authDomain = firebaseConfig.authDomain;\n\n  if (!authDomain) {\n    throw new CodedError('ERR_FIREBASE_RECAPTCHA_CONFIG', \"Missing \\\"authDomain\\\" in firebase web configuration.\");\n  }\n}\n\nexport default function FirebaseRecaptcha(props) {\n  var firebaseConfig = props.firebaseConfig,\n      firebaseVersion = props.firebaseVersion,\n      appVerificationDisabledForTesting = props.appVerificationDisabledForTesting,\n      languageCode = props.languageCode,\n      onVerify = props.onVerify,\n      onLoad = props.onLoad,\n      onError = props.onError,\n      onFullChallenge = props.onFullChallenge,\n      invisible = props.invisible,\n      verify = props.verify,\n      otherProps = _objectWithoutProperties(props, _excluded);\n\n  var webview = React.useRef(null);\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      loaded = _React$useState2[0],\n      setLoaded = _React$useState2[1];\n\n  React.useEffect(function () {\n    if (webview.current && loaded && verify) {\n      webview.current.injectJavaScript(\"\\n    (function(){\\n      window.dispatchEvent(new MessageEvent('message', {data: { verify: true }}));\\n    })();\\n    true;\\n    \");\n    }\n\n    return function () {};\n  }, [webview, verify, loaded]);\n  validateFirebaseConfig(firebaseConfig);\n\n  if (!firebaseConfig) {\n    console.error(\"FirebaseRecaptcha: Missing firebase web configuration. Please set the \\\"expo.web.config.firebase\\\" field in \\\"app.json\\\" or use the \\\"firebaseConfig\\\" prop.\");\n    return null;\n  }\n\n  return React.createElement(WebView, _objectSpread({\n    ref: webview,\n    javaScriptEnabled: true,\n    automaticallyAdjustContentInsets: true,\n    scalesPageToFit: true,\n    mixedContentMode: \"always\",\n    source: getWebviewSource(firebaseConfig, firebaseVersion, appVerificationDisabledForTesting, languageCode, invisible),\n    onError: onError,\n    onMessage: function onMessage(event) {\n      var data = JSON.parse(event.nativeEvent.data);\n\n      switch (data.type) {\n        case 'load':\n          if (onLoad) {\n            setLoaded(true);\n            onLoad();\n          }\n\n          break;\n\n        case 'error':\n          if (onError) {\n            onError();\n          }\n\n          break;\n\n        case 'verify':\n          onVerify(data.token);\n          break;\n\n        case 'fullChallenge':\n          if (onFullChallenge) {\n            onFullChallenge();\n          }\n\n          break;\n      }\n    }\n  }, otherProps));\n}\nFirebaseRecaptcha.defaultProps = {\n  firebaseConfig: DEFAULT_WEB_APP_OPTIONS\n};","map":{"version":3,"mappings":"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","names":["DEFAULT_WEB_APP_OPTIONS","CodedError","React","WebView","getWebviewSource","firebaseConfig","firebaseVersion","appVerificationDisabledForTesting","languageCode","invisible","baseUrl","authDomain","html","JSON","stringify","validateFirebaseConfig","FirebaseRecaptcha","props","onVerify","onLoad","onError","onFullChallenge","verify","otherProps","webview","useRef","useState","loaded","setLoaded","useEffect","current","injectJavaScript","console","error","ref","javaScriptEnabled","automaticallyAdjustContentInsets","scalesPageToFit","mixedContentMode","source","onMessage","event","data","parse","nativeEvent","type","token","defaultProps"],"sourceRoot":"","sources":["../src/FirebaseRecaptcha.tsx"],"sourcesContent":["import { DEFAULT_WEB_APP_OPTIONS, FirebaseOptions } from 'expo-firebase-core';\nimport { CodedError } from 'expo-modules-core';\nimport * as React from 'react';\n\nimport { WebView } from './WebView';\n\ninterface Props extends React.ComponentProps<typeof WebView> {\n  firebaseConfig?: FirebaseOptions;\n  firebaseVersion?: string;\n  appVerificationDisabledForTesting?: boolean;\n  languageCode?: string;\n  onLoad?: () => any;\n  onError?: () => any;\n  onVerify: (token: string) => any;\n  onFullChallenge?: () => any;\n  invisible?: boolean;\n  verify?: boolean;\n}\n\nfunction getWebviewSource(\n  firebaseConfig: FirebaseOptions,\n  firebaseVersion?: string,\n  appVerificationDisabledForTesting: boolean = false,\n  languageCode?: string,\n  invisible?: boolean\n) {\n  firebaseVersion = firebaseVersion || '8.0.0';\n  return {\n    baseUrl: `https://${firebaseConfig.authDomain}`,\n    html: `\n<!DOCTYPE html><html>\n<head>\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\n  <meta name=\"HandheldFriendly\" content=\"true\">\n  <script src=\"https://www.gstatic.com/firebasejs/${firebaseVersion}/firebase-app.js\"></script>\n  <script src=\"https://www.gstatic.com/firebasejs/${firebaseVersion}/firebase-auth.js\"></script>\n  <script type=\"text/javascript\">firebase.initializeApp(${JSON.stringify(firebaseConfig)});</script>\n  <style>\n    html, body {\n      height: 100%;\n      ${invisible ? `padding: 0; margin: 0;` : ``}\n    }\n    #recaptcha-btn {\n      width: 100%;\n      height: 100%;\n      padding: 0;\n      margin: 0;\n      border: 0;\n      user-select: none;\n      -webkit-user-select: none;\n    }\n  </style>\n</head>\n<body>\n  ${\n    invisible\n      ? `<button id=\"recaptcha-btn\" type=\"button\" onclick=\"onClickButton()\">Confirm reCAPTCHA</button>`\n      : `<div id=\"recaptcha-cont\" class=\"g-recaptcha\"></div>`\n  }\n  <script>\n    var fullChallengeTimer;\n    function onVerify(token) {\n      if (fullChallengeTimer) {\n        clearInterval(fullChallengeTimer);\n        fullChallengeTimer = undefined;\n      }\n      window.ReactNativeWebView.postMessage(JSON.stringify({\n        type: 'verify',\n        token: token\n      }));\n    }\n    function onLoad() {\n      window.ReactNativeWebView.postMessage(JSON.stringify({\n        type: 'load'\n      }));\n      firebase.auth().settings.appVerificationDisabledForTesting = ${appVerificationDisabledForTesting};\n      ${languageCode ? `firebase.auth().languageCode = '${languageCode}';` : ''}\n      window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(\"${\n        invisible ? 'recaptcha-btn' : 'recaptcha-cont'\n      }\", {\n        size: \"${invisible ? 'invisible' : 'normal'}\",\n        callback: onVerify\n      });\n      window.recaptchaVerifier.render();\n    }\n    function onError() {\n      window.ReactNativeWebView.postMessage(JSON.stringify({\n        type: 'error'\n      }));\n    }\n    function onClickButton() {\n      if (!fullChallengeTimer) {\n        fullChallengeTimer = setInterval(function() {\n          var iframes = document.getElementsByTagName(\"iframe\");\n          var isFullChallenge = false;\n          for (i = 0; i < iframes.length; i++) {\n            var parentWindow = iframes[i].parentNode ? iframes[i].parentNode.parentNode : undefined;\n            var isHidden = parentWindow && parentWindow.style.opacity == 0;\n            isFullChallenge = isFullChallenge || (\n              !isHidden && \n              ((iframes[i].title === 'recaptcha challenge') ||\n               (iframes[i].src.indexOf('google.com/recaptcha/api2/bframe') >= 0)));\n          }\n          if (isFullChallenge) {\n            clearInterval(fullChallengeTimer);\n            fullChallengeTimer = undefined;\n            window.ReactNativeWebView.postMessage(JSON.stringify({\n              type: 'fullChallenge'\n            }));  \n          }\n        }, 100);\n      }\n    }\n    window.addEventListener('message', function(event) {\n      if (event.data.verify) {\n        document.getElementById('recaptcha-btn').click();\n      }\n    });\n  </script>\n  <script src=\"https://www.google.com/recaptcha/api.js?onload=onLoad&render=explicit&hl=${\n    languageCode ?? ''\n  }\" onerror=\"onError()\"></script>\n</body></html>`,\n  };\n}\n\nfunction validateFirebaseConfig(firebaseConfig?: FirebaseOptions) {\n  if (!firebaseConfig) {\n    throw new CodedError(\n      'ERR_FIREBASE_RECAPTCHA_CONFIG',\n      `Missing firebase web configuration. Please set the \"expo.web.config.firebase\" field in \"app.json\" or use the \"firebaseConfig\" prop.`\n    );\n  }\n  const { authDomain } = firebaseConfig;\n  if (!authDomain) {\n    throw new CodedError(\n      'ERR_FIREBASE_RECAPTCHA_CONFIG',\n      `Missing \"authDomain\" in firebase web configuration.`\n    );\n  }\n}\n\nexport default function FirebaseRecaptcha(props: Props) {\n  const {\n    firebaseConfig,\n    firebaseVersion,\n    appVerificationDisabledForTesting,\n    languageCode,\n    onVerify,\n    onLoad,\n    onError,\n    onFullChallenge,\n    invisible,\n    verify,\n    ...otherProps\n  } = props;\n  const webview = React.useRef(null);\n  const [loaded, setLoaded] = React.useState(false);\n  React.useEffect(() => {\n    if (webview.current && loaded && verify) {\n      // @ts-ignore: Object is possibly null\n      webview.current.injectJavaScript(`\n    (function(){\n      window.dispatchEvent(new MessageEvent('message', {data: { verify: true }}));\n    })();\n    true;\n    `);\n    }\n    return () => {};\n  }, [webview, verify, loaded]);\n  validateFirebaseConfig(firebaseConfig);\n  if (!firebaseConfig) {\n    console.error(\n      `FirebaseRecaptcha: Missing firebase web configuration. Please set the \"expo.web.config.firebase\" field in \"app.json\" or use the \"firebaseConfig\" prop.`\n    );\n    return null;\n  }\n  return (\n    <WebView\n      ref={webview}\n      javaScriptEnabled\n      automaticallyAdjustContentInsets\n      scalesPageToFit\n      mixedContentMode=\"always\"\n      source={getWebviewSource(\n        firebaseConfig,\n        firebaseVersion,\n        appVerificationDisabledForTesting,\n        languageCode,\n        invisible\n      )}\n      onError={onError}\n      onMessage={(event) => {\n        const data = JSON.parse(event.nativeEvent.data);\n        switch (data.type) {\n          case 'load':\n            if (onLoad) {\n              setLoaded(true);\n              onLoad();\n            }\n            break;\n          case 'error':\n            if (onError) {\n              onError();\n            }\n            break;\n          case 'verify':\n            onVerify(data.token);\n            break;\n          case 'fullChallenge':\n            if (onFullChallenge) {\n              onFullChallenge();\n            }\n            break;\n        }\n      }}\n      {...otherProps}\n    />\n  );\n}\n\nFirebaseRecaptcha.defaultProps = {\n  firebaseConfig: DEFAULT_WEB_APP_OPTIONS,\n};\n"]},"metadata":{},"sourceType":"module"}